<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Poker Joker â€“ Buy-in</title>
  <link rel="stylesheet" href="/app/style.css">
</head>
<body>
  <div class="container">
    <h1>ğŸ’¸ Buy-in</h1>

    <!-- === Paketinfo === -->
    <div class="package card">
      <h2>Token-Paket</h2>
      <p><strong>10.000 Tokens</strong></p>
      <p class="price">48,00 â‚¬</p>
    </div>

    <!-- === Buttons === -->
    <div class="row" style="gap:12px; margin-top:10px;">
      <button id="buyinBtnStripe">ğŸ’³ Mit Stripe zahlen</button>
      <button id="buyinBtnPaypal">ğŸ…¿ï¸ Mit PayPal zahlen</button>
      <a href="/app/chat.html" class="muted">ZurÃ¼ck zum Chat</a>
    </div>
  </div>

  <!-- ======================================================= -->
  <!-- === Script-Bereich: Dynamische Preise + Payment-Logik === -->
  <!-- ======================================================= -->
  <script>
  // === Dynamische Preis-/Tokenanzeige ===============================
  async function loadPayConfig() {
    try {
      const res = await fetch('/api/admin/payconfig', { credentials: 'include' });
      if (!res.ok) throw new Error('Fehler beim Laden der Preis-Konfiguration');

      const cfg = await res.json();
      console.log('ğŸ’° PayConfig geladen:', cfg);

      // === Tokenmenge & Preis dynamisch einsetzen ===
      const tokenText = `${cfg.token_amount.toLocaleString()} Tokens`;
      const priceText = `${cfg.price_eur.toFixed(2).replace('.', ',')} â‚¬`;

      const tokenEl = document.querySelector('.package p strong');
      const priceEl = document.querySelector('.price');

      if (tokenEl) tokenEl.textContent = tokenText;
      if (priceEl) priceEl.textContent = priceText;
    } catch (err) {
      console.error('PayConfig Fehler:', err);
    }
  }

  // === Stripe Checkout =============================================
  document.getElementById('buyinBtnStripe')?.addEventListener('click', async () => {
    try {
      const res = await fetch('/api/pay/stripe', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include'
      });
      const data = await res.json();
      if (data?.url) window.location.href = data.url;
      else alert('Stripe-Checkout konnte nicht gestartet werden.');
    } catch (err) {
      console.error('Stripe Fehler:', err);
      alert('Stripe-Verbindung fehlgeschlagen!');
    }
  });

  // === PayPal Checkout =============================================
  document.getElementById('buyinBtnPaypal')?.addEventListener('click', async () => {
    try {
      const res = await fetch('/api/paypal/create', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include'
      });
      const data = await res.json();
      if (data?.url) window.location.href = data.url;
      else alert('PayPal-Checkout konnte nicht gestartet werden.');
    } catch (err) {
      console.error('PayPal Fehler:', err);
      alert('PayPal-Verbindung fehlgeschlagen!');
    }
  });

  // === Seite initialisieren =======================================
  document.addEventListener('DOMContentLoaded', loadPayConfig);
  </script>
</body>
</html>
